// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

enum Estado {
  PENDIENTE
  APROBADO
  ACTIVO
  RECHAZADO
}

enum Genero {
  MASCULINO
  FEMENINO
  MASCULINO_FEMENINO
}

// enum Rol {
//   ADMIN
//   USUARIO
//   DEPORTISTA
//   COORDINADOR
//   FINANCIERO
// }

generator client {
  provider = "prisma-client-js"
}

// generator erd {
//   provider = "prisma-erd-generator"
//   output   = "./erd.svg" // Output file for the diagram
// }

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


model Rol {
  id          Int          @id @default(autoincrement())
  nombre      String
  descripcion String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  deleted     Boolean      @default(false)
  usuariosRol UsuarioRol[]

  @@index([deleted])
  @@index([nombre])
}

model Usuario {
  id                 Int                   @id @default(autoincrement())
  email              String                @unique
  password           String
  nombre             String
  apellido           String
  cedula             String
  categoriaId        Int
  disciplinaId       Int
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  deleted            Boolean               @default(false)
  categoria          Categoria             @relation(fields: [categoriaId], references: [id])
  disciplina         Disciplina            @relation(fields: [disciplinaId], references: [id])
  usuariosRol        UsuarioRol[]
  historialColeccion HistorialColeccion[]
  historialSolicitud HistorialSolicitud[]
  historialPda       HistorialPda[]
  historialDtm       HistorialDtm[]
  historialFinanciero HistorialFinanciero[]

  @@index([nombre])
  @@index([deleted])
}

model Disciplina {
  id           Int               @id @default(autoincrement())
  nombre       String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  deleted      Boolean           @default(false)
  usuarios     Usuario[]
  deportistas  Deportista[]
  colecciones  ColeccionAval[]

  @@index([deleted])
}

model Categoria {
  id           Int               @id @default(autoincrement())
  nombre       String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  deleted      Boolean           @default(false)
  usuarios     Usuario[]
  deportistas  Deportista[]
  colecciones  ColeccionAval[]

  @@index([deleted])
}

model UsuarioRol {
  usuarioId Int
  rolId     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  usuario Usuario @relation(fields: [usuarioId], references: [id])
  rol     Rol     @relation(fields: [rolId], references: [id])

  @@id([usuarioId, rolId])
  @@index([usuarioId])
  @@index([rolId])
}


model ColeccionAval {
  id                 Int                @id @default(autoincrement())
  nombreEvento       String             @db.VarChar(400)
  lugarEvento        String             @db.VarChar(255)
  fechaEvento        DateTime
  disciplinaId       Int
  categoriaId        Int
  ciudad             String             @db.VarChar(255)
  estado             Estado             @default(PENDIENTE)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  deleted            Boolean            @default(false)

  disciplina         Disciplina         @relation(fields: [disciplinaId], references: [id])
  categoria          Categoria          @relation(fields: [categoriaId], references: [id])
  deportistasAval    DeportistaAval[]
  historialColeccion HistorialColeccion[]
  solicitudes        Solicitud[]
  pdas               Pda[]
  dtms               Dtm[]
  financieros        Financiero[]

  @@index([disciplinaId])
  @@index([categoriaId])
  @@index([deleted])
  @@index([estado])
}

model DeportistaAval {
  id              Int          @id @default(autoincrement())
  coleccionAvalId Int
  deportistaId    Int
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  coleccionAval   ColeccionAval @relation(fields: [coleccionAvalId], references: [id])
  deportista      Deportista    @relation(fields: [deportistaId], references: [id])

  @@index([coleccionAvalId])
  @@index([deportistaId])
}

model HistorialColeccion {
  id              Int            @id @default(autoincrement())
  fecha           DateTime
  estado          Estado
  usuarioId       Int
  coleccionAvalId Int
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  usuario         Usuario        @relation(fields: [usuarioId], references: [id])
  coleccionAval   ColeccionAval  @relation(fields: [coleccionAvalId], references: [id])

  @@index([usuarioId])
  @@index([estado])
  @@index([createdAt])
}

model Solicitud {
  id                 Int                 @id @default(autoincrement())
  descripcion        String              @db.VarChar(600)
  archivo            String              @db.VarChar(355)
  objetivos          String              @db.VarChar(600)
  criterios          String              @db.VarChar(600)
  fechaSalida        DateTime
  rutaSalida         String              @db.VarChar(255)
  transporteSalida   String              @db.VarChar(255)
  fechaRetorno       DateTime
  horaRetorno        DateTime
  transporteRetorno  String              @db.VarChar(255)
  observaciones      String?             @db.VarChar(600)
  coleccionAvalId    Int
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deleted            Boolean             @default(false)

  coleccionAval      ColeccionAval       @relation(fields: [coleccionAvalId], references: [id])
  requerimientos     Requerimiento[]
  historialSolicitud HistorialSolicitud[]

  @@index([coleccionAvalId])
  @@index([fechaSalida])
  @@index([fechaRetorno])
  @@index([createdAt])
  @@index([deleted])
}

model Requerimiento {
  id            Int       @id @default(autoincrement())
  solicitudId   Int
  rubro         String    @db.VarChar(255)
  cantidadDias  String    @db.VarChar(100)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  solicitud     Solicitud @relation(fields: [solicitudId], references: [id])

  @@index([solicitudId])
}

model HistorialSolicitud {
  id           Int       @id @default(autoincrement())
  estado       Estado
  usuarioId    Int
  solicitudId  Int
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  usuario      Usuario   @relation(fields: [usuarioId], references: [id])
  solicitud    Solicitud @relation(fields: [solicitudId], references: [id])

  @@index([usuarioId])
  @@index([estado])
  @@index([createdAt])
  @@index([solicitudId])
}

model Deportista {
  id               Int              @id @default(autoincrement())
  nombres          String           @db.VarChar(150)
  apellidos        String           @db.VarChar(150)
  cedula           String           @unique @db.VarChar(50)
  fechaNacimiento  DateTime
  categoriaId      Int
  disciplinaId     Int
  afiliacion       Boolean          @default(false)
  genero           Genero
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  deleted          Boolean          @default(false)

  categoria        Categoria        @relation(fields: [categoriaId], references: [id])
  disciplina       Disciplina       @relation(fields: [disciplinaId], references: [id])
  deportistasAval  DeportistaAval[]

  @@index([nombres])
  @@index([categoriaId])
  @@index([deleted])
}

model Actividad {
  id          Int      @id @default(autoincrement())
  nombre      String   @db.VarChar(255)
  numero      Int
  descripcion String   @db.VarChar(600)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  items       Item[]

  @@index([numero])
}

model Item {
  id              Int             @id @default(autoincrement())
  actividadId     Int
  nombre          String          @db.VarChar(255)
  numero          Int
  descripcion     String          @db.VarChar(600)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  actividad       Actividad       @relation(fields: [actividadId], references: [id])
  pdaItems        PdaItem[]
  financieroItems FinancieroItem[]

  @@index([actividadId])
  @@index([numero])
}

model Pda {
  id                  Int             @id @default(autoincrement())
  coleccionAvalId     Int
  descripcion         String          @db.VarChar(600)
  documento           String          @db.VarChar(355)
  responsableAnticipo Int
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  deleted             Boolean         @default(false)

  coleccionAval       ColeccionAval   @relation(fields: [coleccionAvalId], references: [id])
  historialPda        HistorialPda[]
  pdaItems            PdaItem[]

  @@index([createdAt])
  @@index([deleted])
}

model HistorialPda {
  id         Int      @id @default(autoincrement())
  estado     Estado
  usuarioId  Int
  pdaId      Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  usuario    Usuario  @relation(fields: [usuarioId], references: [id])
  pda        Pda      @relation(fields: [pdaId], references: [id])

  @@index([usuarioId])
  @@index([estado])
  @@index([createdAt])
  @@index([pdaId])
}

model PdaItem {
  id         Int      @id @default(autoincrement())
  pdaId      Int
  itemId     Int
  presupuesto Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  pda        Pda      @relation(fields: [pdaId], references: [id])
  item       Item     @relation(fields: [itemId], references: [id])

  @@index([pdaId])
  @@index([itemId])
}

model Dtm {
  id                  Int             @id @default(autoincrement())
  coleccionAvalId     Int
  descripcion         String          @db.VarChar(600)
  documento           String          @db.VarChar(355)
  observacion         String?         @db.VarChar(600)
  fechaPresentacion   DateTime
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  deleted             Boolean         @default(false)

  coleccionAval       ColeccionAval   @relation(fields: [coleccionAvalId], references: [id])
  historialDtm        HistorialDtm[]

  @@index([createdAt])
  @@index([fechaPresentacion])
  @@index([descripcion])
  @@index([deleted])
}

model HistorialDtm {
  id         Int      @id @default(autoincrement())
  estado     Estado
  usuarioId  Int
  dtmId      Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  usuario    Usuario  @relation(fields: [usuarioId], references: [id])
  dtm        Dtm      @relation(fields: [dtmId], references: [id])

  @@index([usuarioId])
  @@index([estado])
  @@index([createdAt])
  @@index([dtmId])
}

model Financiero {
  id                Int               @id @default(autoincrement())
  coleccionAvalId   Int
  descripcion       String            @db.VarChar(600)
  cuentaBancaria    String            @db.VarChar(255)
  fondos            String            @db.VarChar(255)
  notas             String?           @db.VarChar(400)
  razonSocial       String            @db.VarChar(255)
  ruc               String            @db.VarChar(50)
  direccion         String            @db.VarChar(255)
  telefono          String            @db.VarChar(50)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  deleted           Boolean           @default(false)

  coleccionAval     ColeccionAval     @relation(fields: [coleccionAvalId], references: [id])
  historialFinanciero HistorialFinanciero[]
  financieroItems   FinancieroItem[]

  @@index([createdAt])
  @@index([descripcion])
  @@index([deleted])
}

model HistorialFinanciero {
  id             Int       @id @default(autoincrement())
  estado         Estado
  usuarioId      Int
  financieroId   Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  usuario        Usuario   @relation(fields: [usuarioId], references: [id])
  financiero     Financiero @relation(fields: [financieroId], references: [id])

  @@index([usuarioId])
  @@index([estado])
  @@index([createdAt])
  @@index([financieroId])
}

model FinancieroItem {
  id             Int        @id @default(autoincrement())
  financieroId   Int
  itemId         Int
  precioAsignado Int
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  financiero     Financiero  @relation(fields: [financieroId], references: [id])
  item           Item        @relation(fields: [itemId], references: [id])

  @@index([financieroId])
  @@index([itemId])
}


