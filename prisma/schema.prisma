// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

enum Estado {
  PENDIENTE
  APROBADO
  ACTIVO
  RECHAZADO
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


model Rol {
  id          Int      @id @default(autoincrement())
  nombre      String   @db.VarChar(150)
  descripcion String?  @db.VarChar(150)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  deleted     Boolean  @default(false) // soft delete
  UsuariosRol UsuarioRol[]

  @@index([deleted])
  @@index([nombre])
}

model Usuario {
  id            Int         @id @default(autoincrement())
  email         String      @unique @db.VarChar(150)
  password      String      @db.VarChar(150)
  nombre        String      @db.VarChar(150) 
  apellido      String      @db.VarChar(150)
  cedula        String      @unique @db.VarChar(50)
  categoria_id  Int
  disciplina_id Int
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt
  deleted       Boolean     @default(false) // soft delete
  Categoria     Categoria   @relation(fields: [categoria_id], references: [id])
  Disciplina    Disciplina  @relation(fields: [disciplina_id], references: [id])
  UsuariosRol   UsuarioRol[]
  HistorialColeccion HistorialColeccion[]
  HistorialSolicitud HistorialSolicitud[]
  HistorialPda HistorialPda[]
  HistorialDtm HistorialDtm[]
  HistorialFinanciero HistorialFinanciero[]

  @@index([nombre])
  @@index([deleted])
}

model Disciplina {
  id          Int       @id @default(autoincrement())
  nombre      String    @db.VarChar(200)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  deleted     Boolean   @default(false) // soft delete
  Usuarios    Usuario[]
  Deportistas Deportista[]
  Colecciones ColeccionAval[]

  @@index([deleted])
}


model Categoria {
  id          Int       @id @default(autoincrement())
  nombre      String    @db.VarChar(200)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  deleted     Boolean   @default(false) // soft delete
  Usuarios    Usuario[]
  Deportistas Deportista[]
  Colecciones ColeccionAval[]

  @@index([deleted])
}

model UsuarioRol {
  usuario_id Int
  rol_id     Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  Usuario Usuario @relation(fields: [usuario_id], references: [id])
  Rol     Rol     @relation(fields: [rol_id], references: [id])

  @@id([usuario_id, rol_id])
  @@index([rol_id])
  @@index([usuario_id])
}

model ColeccionAval {
  id              Int                 @id @default(autoincrement())
  nombre_evento   String              @db.VarChar(400)
  lugar_evento    String              @db.VarChar(255)
  fecha_evento    DateTime            
  disciplina_id   Int
  categoria_id    Int
  ciudad          String              @db.VarChar(255)
  created_at      DateTime            @default(now())
  updated_at      DateTime            @updatedAt
  deleted         Boolean             @default(false) // soft delete
  Disciplina      Disciplina          @relation(fields: [disciplina_id], references: [id])
  Categoria       Categoria           @relation(fields: [categoria_id], references: [id])
  DeportistasAval DeportistaAval[]
  HistorialColeccion HistorialColeccion[]

  @@index([disciplina_id])
  @@index([categoria_id])
  @@index([deleted])

}

model DeportistaAval {
  id                Int            @id @default(autoincrement())
  coleccion_aval_id Int
  deportista_id     Int
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  ColeccionAval     ColeccionAval  @relation(fields: [coleccion_aval_id], references: [id])
  Deportista        Deportista     @relation(fields: [deportista_id], references: [id])

  @@index([coleccion_aval_id])
  @@index([deportista_id])
}

model HistorialColeccion {
  id                Int            @id @default(autoincrement())
  fecha             DateTime
  estado            Estado
  usuario_id        Int
  coleccion_aval_id Int
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  Usuario           Usuario        @relation(fields: [usuario_id], references: [id])
  ColeccionAval     ColeccionAval  @relation(fields: [coleccion_aval_id], references: [id])

  @@index([usuario_id])
  @@index([estado])
  @@index([created_at])
}

model Solicitud {
  id              Int            @id @default(autoincrement())
  descripcion     String         @db.VarChar(600)
  archivo         String         @db.VarChar(355)
  objetivos       String         @db.VarChar(600)
  criterios       String         @db.VarChar(600)
  fecha_salida    DateTime
  ruta_salida     String         @db.VarChar(255)
  transporte_salida String       @db.VarChar(255)
  fecha_retorno   DateTime
  hora_retorno    DateTime
  transporte_retorno String      @db.VarChar(255)
  observaciones   String?        @db.VarChar(600)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  deleted         Boolean  @default(false) // soft delete
  Requerimientos  Requerimiento[]
  HistorialSolicitud HistorialSolicitud[]

  @@index([fecha_salida])
  @@index([created_at])
  @@index([fecha_retorno])
  @@index([deleted])

}

model Requerimiento {
  id           Int       @id @default(autoincrement())
  solicitud_id   Int
  rubro        String    @db.VarChar(255)
  cantidad_dias String   @db.VarChar(100)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  Solicitud    Solicitud @relation(fields: [solicitud_id], references: [id])

  @@index([solicitud_id])
}

model HistorialSolicitud {
  id           Int       @id @default(autoincrement())
  estado       Estado
  usuario_id   Int
  solicitud_id Int
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  Usuario      Usuario  @relation(fields: [usuario_id], references: [id])
  Solicitud    Solicitud @relation(fields: [solicitud_id], references: [id])

  @@index([usuario_id])
  @@index([estado])
  @@index([created_at])
  @@index([solicitud_id])
}

model Deportista {
  id               Int           @id @default(autoincrement())
  nombres          String        @db.VarChar(150)
  apellidos        String        @db.VarChar(150)
  cedula           String        @unique @db.VarChar(50)
  fecha_nacimiento DateTime
  categoria_id     Int
  disciplina_id    Int
  genero           String        @db.VarChar(50)
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  deleted          Boolean       @default(false) // soft delete
  Categoria        Categoria     @relation(fields: [categoria_id], references: [id])
  Disciplina       Disciplina    @relation(fields: [disciplina_id], references: [id])
  DeportistasAval  DeportistaAval[]

  @@index([nombres])
  @@index([categoria_id])
  @@index([deleted])

}

model Actividad {
  id          Int        @id @default(autoincrement())
  nombre      String     @db.VarChar(255)
  numero      Int
  descripcion String     @db.VarChar(600)
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  Items       Item[]

  @@index([numero])
}

model Item {
  id           Int       @id @default(autoincrement())
  actividad_id Int
  nombre       String    @db.VarChar(255)
  numero       Int       
  descripcion  String   @db.VarChar(600)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  Actividad    Actividad @relation(fields: [actividad_id], references: [id])
  PdaItems     PdaItem[]
  FinancieroItems FinancieroItem[]

  @@index([actividad_id])
  @@index([numero])
}

model Pda {
  id                   Int            @id @default(autoincrement())
  descripcion          String         @db.VarChar(600)
  documento            String         @db.VarChar(355)
  responsable_anticipo Int
  created_at           DateTime       @default(now())
  updated_at           DateTime       @updatedAt
  deleted              Boolean        @default(false) // soft delete
  HistorialPda         HistorialPda[]
  PdaItems             PdaItem[]

  @@index([created_at])
  @@index([deleted])
}

model HistorialPda {
  id         Int     @id @default(autoincrement())
  estado     Estado
  usuario_id Int
  pda_id     Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  Usuario    Usuario @relation(fields: [usuario_id], references: [id])
  Pda        Pda     @relation(fields: [pda_id], references: [id])

  @@index([usuario_id])
  @@index([estado])
  @@index([created_at])
  @@index([pda_id])
  
}

model PdaItem {
  id         Int     @id @default(autoincrement())
  pda_id     Int
  item_id    Int
  presupuesto Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  Pda        Pda     @relation(fields: [pda_id], references: [id])
  Item       Item    @relation(fields: [item_id], references: [id])

  @@index([pda_id])
  @@index([item_id])
}

model Dtm {
  id                 Int            @id @default(autoincrement())
  descripcion        String         @db.VarChar(600)
  documento          String         @db.VarChar(355)
  observacion        String?        @db.VarChar(600)
  fecha_presentacion DateTime
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  deleted            Boolean        @default(false) // soft delete
  HistorialDtm       HistorialDtm[]

  @@index([created_at])
  @@index([fecha_presentacion])
  @@index([descripcion])
  @@index([deleted])

}

model HistorialDtm {
  id         Int     @id @default(autoincrement())
  estado     Estado
  usuario_id Int
  dtm_id     Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  Usuario    Usuario @relation(fields: [usuario_id], references: [id])
  Dtm        Dtm     @relation(fields: [dtm_id], references: [id])

  @@index([usuario_id])
  @@index([estado])
  @@index([created_at])
  @@index([dtm_id])
  
}


model Financiero {
  id            Int              @id @default(autoincrement())
  descripcion   String           @db.VarChar(600)
  cuenta_bancaria String         @db.VarChar(255)
  fondos        String           @db.VarChar(255)
  notas         String?          @db.VarChar(400)
  razon_social  String           @db.VarChar(255)
  ruc           String           @db.VarChar(50)
  direccion     String           @db.VarChar(255)
  telefono      String           @db.VarChar(50)
  created_at    DateTime         @default(now())
  updated_at    DateTime         @updatedAt
  deleted       Boolean          @default(false) // soft delete
  HistorialFinanciero HistorialFinanciero[]
  FinancieroItems FinancieroItem[]

  @@index([created_at])
  @@index([descripcion])
  @@index([deleted])

}

model HistorialFinanciero {
  id           Int       @id @default(autoincrement())
  estado       Estado
  usuario_id   Int
  financiero_id Int
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  Usuario      Usuario  @relation(fields: [usuario_id], references: [id])
  Financiero   Financiero @relation(fields: [financiero_id], references: [id])

  @@index([usuario_id])
  @@index([estado])
  @@index([created_at])
  @@index([financiero_id])
}

model FinancieroItem {
  id            Int        @id @default(autoincrement())
  financiero_id Int
  item_id       Int
  precio_asignado Int
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt
  Financiero    Financiero @relation(fields: [financiero_id], references: [id])
  Item          Item       @relation(fields: [item_id], references: [id])

  @@index([financiero_id])
  @@index([item_id])
}

